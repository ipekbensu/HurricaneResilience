<html>
<head>
    <!-- data -->
    <!-- ~~~~~~~~~~~~~~~~~~~~
    note to self:
    add data
    ~~~~~~~~~~~~~~~~~~~~ -->
    <script src="./all-geocodes-v2016.js"></script>
    <script src="./DEC_10_DP_DPDP1.js"></script>
    <!-- functions -->
    <script src="./functions.js"></script>
    <script src="./run.js"></script>
    <!-- mapping -->
    <script src="https://maps.google.com/maps/api/js?sensor=false&key=AIzaSyARxs_0QWBQzZ-7tnFIkcz6Tzh5Fr1I0xg"></script>
</head>
<body>
    <!-- mapping -->
    <h1>Loss Amplification</h1>
    <h2>User selects SED factor.</h2>
    <select id="dropdown1" onchange="markersEdit()">
        <option value="a">Age-----------------------------</option>
        <option value="e">Ethnicity/Race</option>
        <option value="f">Family Structure</option>
        <option value="g">Gender</option>
        <option value="s">Socioeconomic Status</option>
        <option value="b">Built Environment</option>
    </select>
    <h2>User selects morbidity.</h2>
    <select id="dropdown2" onchange="markersEdit()">
        <option value="i">Injuries------------------------</opton>
        <option value="f">Fatalities</option>
        <option value="p">Cases of PTSD</option>
    </select>
    <h1>Map:</h1>
    <p>Displays 10-%ile loss amplifications.</p>
    <div id="map" style="width: 640px; height: 480px"></div>
    <h1>Text:</h1>
    <p>Explains effect of chosen SED factor on chosen morbidity.</p>
    <h1>Reference:</h1>
    <p>
        Sutley, 2016<br>
        US Census Bureau
    </p>
</body>
<script>
    var map = [];
    var markers = [];

    function mapInit(){
        var options = {
            title: 'Florida',
            center: new google.maps.LatLng(27.6648, -81.5158),
            zoom: 6,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById('map'), options);
    };

    function markersInit(){
        coordFL.data.forEach(function(county, countyIndex){
            var marker = new google.maps.Marker({
                title: county[0] + '\n' + sedbinFL.data.age.inj[countyIndex][1] + '% increase to baseline',
                map: map,
                position: new google.maps.LatLng(county[2], county[3]),
                // ~~~~~~~~~~~~~~~~~~~~
                // note to self:
                // edit icons
                // ~~~~~~~~~~~~~~~~~~~~
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 1 + Number(sedbinFL.data.age.inj[countyIndex][1])/20,
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                }
            });
            markers.push(marker);
        });
    };

    function markersEdit(){
        markersClear();
        var selected1 = document.getElementById('dropdown1');
        var res1 = selected1.options[selected1.selectedIndex].text;
        var fact = null;
        if(res1 == 'Age-----------------------------'){
            fact = 'age';
        }
        if(res1 == 'Ethnicity/Race'){
            fact = 'eth';
        }
        if(res1 == 'Family Structure'){
            fact = 'fam';
        }
        if(res1 == 'Gender'){
            fact = 'gen';
        }
        if(res1 == 'Socioeconomic Status'){
            fact = 'soc';
        }
        if(res1 == 'Built Environment'){
            fact = 'bui';
        }
        var selected2 = document.getElementById('dropdown2');
        var res2 = selected2.options[selected2.selectedIndex].text;
        var morb = null;
        if(res2 == 'Injuries------------------------'){
            morb = 'inj';
        }
        if(res2 == 'Fatalities'){
            morb = 'fat';
        }
        if(res2 == 'Cases of PTSD'){
            morb = 'pts';
        }
        coordFL.data.forEach(function(county, countyIndex){
            var marker = new google.maps.Marker({
                title: county[0] + '\n' + sedbinFL.data[fact][morb][countyIndex][1] + '% increase to baseline',
                map: map,
                position: new google.maps.LatLng(county[2], county[3]),
                // ~~~~~~~~~~~~~~~~~~~~
                // note to self:
                // edit icons
                // ~~~~~~~~~~~~~~~~~~~~
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 1 + Number(sedbinFL.data[fact][morb][countyIndex][1])/20,
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                }
            });
            markers.push(marker);
        });
    };

    function markersClear(){
        for(var i=0; i<markers.length; i++){
            markers[i].setMap(null);
        }
        markers = [];
    };

    function viewMap(){
        google.maps.event.addDomListener(window, 'load', mapInit);
        google.maps.event.addDomListener(window, 'load', markersInit);
    };
    viewMap();
</script>
</html>