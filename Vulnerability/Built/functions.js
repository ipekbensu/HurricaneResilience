var functions = {};

functions.readCounties = function(fips, csv){
    // var data = ['County', 'FIPS code'];
    var data = [];
    csv = csv.split('\n');
    csv.forEach(function(item){
        item = item.split(',');
        if(item[0] == '050' && item[1] == fips){
            data.push([
                item[6],
                fips + item[2]
            ]);
        }
    });
    // test
    // return data.length;
    return data;
};

functions.readTracts = function(fips, csv, csv2){
    // var data = ['Tract', 'Population', '# of buildings', 'Year built'];
    var data = [];
    fips = fips.split('');
    csv = csv.split('\n');
    csv.forEach(function(item){
        item = item.split(',');
        var res = item[0].split('');
        if(fips[2] == res[2]){
            if(fips[3] == res[3]){
                if(fips[4] == res[4]){
                    // data.push(item[0]);
                    data.push([
                        item[0],
                        item[1], // population
                        null, // # of buildings
                        item[55] // year built
                    ]);
                }
            }
        }
    });
    csv2 = csv2.split('\n');
    csv2.forEach(function(item){
        item = item.split(',');
        var res = item[0].split('');
        if(fips[2] == res[2]){
            if(fips[3] == res[3]){
                if(fips[4] == res[4]){
                    data.forEach(function(item2){
                        if(item2[0] == item[0]){
                            item2[2] = String(Number(item[1]) + Number(item[2]) + Number(item[3]) + Number(item[4]) + Number(item[5]));
                        }
                    });
                }
            }
        }
    });
    return data;
};

functions.editCounties = function(county, tracts, data){
    // var data = ['County', 'Population', '%-population','# of buildings', '%-# of buildings', 'Year built', 'Decade'];
    var pop = 0;
    var bui = 0;
    var yearbuilt = 0;
    tracts.forEach(function(item){
        pop += Number(item[1]);
        bui += Number(item[2]);
        yearbuilt += item[2]*item[3];
    });
    yearbuilt /= bui;
    yearbuilt = Math.round(yearbuilt);
    data.push([
        county[0],
        county[1],
        pop,
        Math.ceil(100*pop/18288049),
        bui,
        Math.ceil(100*bui/6959221),
        yearbuilt,
        10*Math.floor((yearbuilt - 1900)/10)
    ]);
};

functions.matchCoordFL = function(county, countyIndex, data){
    // data = ['County', 'FIPS code', 'Latitude', 'Longitude'];
    var coordFL_ = [
        '29.6580° N, 82.3018° W',
        '30.3931° N, 82.3018° W',
        '30.1805° N, 85.6846° W',
        '29.9724° N, 82.1714° W',
        '28.2639° N, 80.7214° W',
        '26.1901° N, 80.3659° W',
        '30.3475° N, 85.1894° W',
        '26.8946° N, 81.9098° W',
        '28.8849° N, 82.5186° W',
        '29.9944° N, 81.7787° W',
        '26.0700° N, 81.4279° W',
        '30.1813° N, 82.6051° W',
        '27.2142° N, 81.7787° W',
        '29.5207° N, 83.1649° W',
        '30.3501° N, 81.6035° W',
        '30.6389° N, 87.3414° W',
        '29.4086° N, 81.2519° W',
        '29.7818° N, 84.8568° W',
        '30.5563° N, 84.6479° W',
        '29.6871° N, 82.8210° W',
        '26.9844° N, 81.0755° W',
        '29.8002° N, 85.3550° W',
        '30.4756° N, 82.9502° W',
        '27.4502° N, 81.8224° W',
        '26.6105° N, 81.0755° W',
        '28.5579° N, 82.4753° W',
        '27.3400° N, 81.3400° W',
        '27.9904° N, 82.3018° W',
        '30.8741° N, 85.8077° W',
        '27.6948° N, 80.5438° W',
        '30.7151° N, 85.1894° W',
        '30.4312° N, 83.8897° W',
        '30.0300° N, 83.2078° W',
        '28.7028° N, 81.7787° W',
        '26.6630° N, 81.9535° W',
        '30.4906° N, 84.1857° W',
        '29.3179° N, 82.8210° W',
        '30.1508° N, 84.8568° W',
        '30.4586° N, 83.5070° W',
        '27.4799° N, 82.3452° W',
        '29.2788° N, 82.1278° W',
        '27.0805° N, 80.4104° W',
        '25.5516° N, 80.6327° W',
        '24.5557° N, 81.7826° W',
        '30.5927° N, 81.8224° W',
        '30.5773° N, 86.6611° W',
        '27.3462° N, 80.8987° W',
        '28.4845° N, 81.2519° W',
        '28.1020° N, 81.0755° W',
        '26.6515° N, 80.2767° W',
        '28.3232° N, 82.4319° W',
        '27.8764° N, 82.7779° W',
        '27.8617° N, 81.6912° W',
        '29.6265° N, 81.7787° W',
        '29.9719° N, 81.4279° W',
        '27.3226° N, 80.5438° W',
        '30.7690° N, 86.9824° W',
        '27.1996° N, 82.3452° W',
        '28.7132° N, 81.2078° W',
        '28.6748° N, 82.0843° W',
        '30.2485° N, 82.9932° W',
        '30.0994° N, 83.6774° W',
        '30.0745° N, 82.3452° W',
        '29.0280° N, 81.0755° W',
        '30.1302° N, 84.3542° W',
        '30.5640° N, 86.1752° W',
        '30.5487° N, 85.6846° W'
    ];
    coordFL_.forEach(function(item, index){
        item = item.replace('° N', '');
        item = item.replace('° W', '');
        item = item.split(', ');
        item[1] = '-' + item[1];
        coordFL_[index] = item;
    });
    data.push([
        county[0],
        county[1],
        coordFL_[countyIndex][0],
        coordFL_[countyIndex][1]
    ]);
};

// debugging in node
// module.exports = functions;