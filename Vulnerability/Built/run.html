<html>
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        * {
            box-sizing: border-box;
        }
        .column{
            float: left;
            width: 50%;
            padding: 0px;
        }
        .row:after{
            content: "";
            display: table;
            clear: both;
        }
    </style>
    <!-- data -->
    <!-- ~~~~~~~~~~~~~~~~~~~~
    note to self:
    add data
    ~~~~~~~~~~~~~~~~~~~~ -->
    <script src="./all-geocodes-v2016.js"></script>
    <script src="./Demographics.js"></script>
    <script src="./BuildingCountByGeneralBuildingType.js"></script>
    <!-- functions -->
    <script src="./functions.js"></script>
    <script src="./run.js"></script>
    <!-- mapping -->
    <script src="https://maps.google.com/maps/api/js?sensor=false&key=AIzaSyARxs_0QWBQzZ-7tnFIkcz6Tzh5Fr1I0xg"></script>
</head>
<body>
    <!-- mapping -->
    <h1>Vulnerability</h1>
    <h2>User selects attribute.</h2>
    <select id="dropdown" onchange="markersEdit()">
        <!-- ~~~~~~~~~~~~~~~~~~~~
        note to self:
        edit options
        ~~~~~~~~~~~~~~~~~~~~ -->
        <option value="p">Population Density--------------</option>
        <option value="d">Building Density</option>
        <option value="y">Building Age</option>
    </select>
    <div class="row">
        <div class="column">
            <h1>Map:</h1>
            <p>Displays %ile distributions.</p>
            <div id="map" style="width: 600px; height: 600px"></div>
        </div>
        <div class="column">
            <h1>Text:</h1>
            <p>Explains attribute of vulnerability.</p>
            <h1>Reference:</h1>
            <p>
                Cutter, 2003<br>
                US Census Bureau<br>
                FEMA Hazus
            </p>
        </div>
    </div>
</body>
<script>
    var map = [];
    var markers = [];

    function mapInit(){
        var options = {
            title: 'Florida',
            center: new google.maps.LatLng(27.6648, -81.5158),
            zoom: 6,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById('map'), options);
    };

    function markersInit(){
        coordFL.data.forEach(function(county, countyIndex){
            var marker = new google.maps.Marker({
                title: county[0] + '\n' + countiesFL.data[countyIndex][3] + "% of population",
                map: map,
                position: new google.maps.LatLng(county[2], county[3]),
                // ~~~~~~~~~~~~~~~~~~~~
                // note to self:
                // edit icons
                // ~~~~~~~~~~~~~~~~~~~~
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 1 + Number(countiesFL.data[countyIndex][3]),
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                }
            });
            markers.push(marker);
        });
    };

    function markersEdit(){
        markersClear();      
        var selected = document.getElementById('dropdown');
        var res = selected.options[selected.selectedIndex].text;
        var info = null;
        var scale = null;
        coordFL.data.forEach(function(county, countyIndex){
            if(res == 'Population Density--------------'){
                info = countiesFL.data[countyIndex][3] + "% of population";
                scale = 1 + Number(countiesFL.data[countyIndex][3]);
                color = '#FF0000';
            }
            if(res == 'Building Density'){
                info = countiesFL.data[countyIndex][5] + "% of building stock";
                scale = 1 + Number(countiesFL.data[countyIndex][5]);
                color = '#FF0000';
            }
            if(res == 'Building Age'){
                info = countiesFL.data[countyIndex][5] + "% of building stock" + '\n' + "Mostly built in " + countiesFL.data[countyIndex][7] + "'s";
                scale = 1 + Number(countiesFL.data[countyIndex][5]);
                if(countiesFL.data[countyIndex][7] == 70){
                    // red if built in 70's
                    color = '#FF0000';
                }
                if(countiesFL.data[countyIndex][7] == 80){
                    // green if built in 80's
                    color = '#008000';
                }
                if(countiesFL.data[countyIndex][7] == 90){
                    // blue if built in 90's
                    color = '#0000FF';
                }
            }
            var marker = new google.maps.Marker({
                title: county[0] + '\n' + info,
                map: map,
                position: new google.maps.LatLng(county[2], county[3]),
                // ~~~~~~~~~~~~~~~~~~~~
                // note to self:
                // edit icons
                // ~~~~~~~~~~~~~~~~~~~~
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: scale,
                    strokeColor: color,
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: color,
                    fillOpacity: 0.35,
                }
            });
            markers.push(marker);
        });
    };

    function markersClear(){
        for(var i=0; i<markers.length; i++){
            markers[i].setMap(null);
        }
        markers = [];
    };

    function viewMap(){
        google.maps.event.addDomListener(window, 'load', mapInit);
        google.maps.event.addDomListener(window, 'load', markersInit);
    };
    viewMap();
</script>
</html>